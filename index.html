<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Portfolio</title>
  <link rel="icon" type="image/jpg" href="unkoala.jpg">
  
  <!-- ★★★ 連結您的本地 CSS ★★★ -->
  <link href="./output.css" rel="stylesheet">
  
  <!-- 字體 -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <!-- 圖示庫 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- 函式庫 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/vanilla-tilt/1.8.0/vanilla-tilt.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

  <style>
    /* 額外補丁樣式 (尚未整合進 output.css 的部分) */
    
    /* 聊天視窗調整手柄 */
    .resize-handle {
      position: absolute; top: 0; left: 0; width: 20px; height: 20px;
      cursor: nwse-resize; z-index: 50;
    }
    .resize-handle::after {
      content: ''; position: absolute; top: 6px; left: 6px; width: 8px; height: 8px;
      border-top: 2px solid rgba(255,255,255,0.3); border-left: 2px solid rgba(255,255,255,0.3);
      border-top-left-radius: 2px; transition: border-color 0.3s;
    }
    .resize-handle:hover::after { border-color: #10b981; }

    /* Cookie 提示 */
    .cookie-alert {
      background: rgba(16, 185, 129, 0.1); border-bottom: 1px solid rgba(16, 185, 129, 0.2);
      font-size: 0.7rem; color: #94a3b8; padding: 8px 12px; display: flex; align-items: flex-start; gap: 8px;
      animation: fadeIn 0.5s ease;
    }
    .cookie-alert i { color: #10b981; margin-top: 2px; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

    /* 強制顯示滑鼠游標，並隱藏自定義游標 (覆蓋原本的設定) */
    body { cursor: auto !important; }
    .cursor-dot, .cursor-outline { display: none !important; }
    .dock-item, .ctx-item, a, button, .cursor-hover { cursor: pointer !important; }
  </style>
</head>
<body class="font-sans min-h-screen relative selection:bg-indigo-500 selection:text-white">

  <!-- ==================== CONFIGURATION ==================== -->
  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbw1J5DNcuCTfTGeQXhosPZYOW0MAfXDCNBHIi7rQTQMw7Nrfieuc4XEw0diuQkQ6XdUPg/exec";
  </script>
  <!-- ======================================================= -->

  <!-- 1. 優雅進場 Preloader -->
  <div id="preloader">
    <div class="loader-content">
      <div class="text-3xl font-bold text-white tracking-widest mb-2 font-mono">SYSTEM LOADING</div>
      <div class="text-xs text-slate-500 font-mono mb-4">INITIALIZING ASSETS...</div>
      <div class="loader-bar"><div class="loader-progress" id="loader-progress"></div></div>
    </div>
  </div>

  <!-- 背景特效 -->
  <div class="gradient-bg">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>
  
  <!-- UI 元件 -->
  <div id="scroll-progress" class="fixed top-0 left-0 h-[2px] bg-gradient-to-r from-indigo-500 via-purple-500 to-emerald-500 z-50 transition-all duration-100" style="width: 0%"></div>
  
  <!-- 游標 (僅電腦版顯示) -->
  <div class="cursor-dot hidden md:block"></div>
  <div class="cursor-outline hidden md:block"></div>

  <!-- 隱藏終端機 -->
  <div id="terminal-overlay" class="fixed top-0 left-0 w-full h-1/2 bg-[#0f172a]/95 backdrop-blur-xl z-[10000] border-b border-indigo-500/30 shadow-2xl flex flex-col p-6 font-mono text-sm text-indigo-300 overflow-hidden transition-transform duration-300 -translate-y-full">
    <div class="flex justify-between items-center mb-4 border-b border-indigo-500/20 pb-2 select-none">
      <span class="flex items-center gap-2"><i class="fas fa-terminal"></i> SECRET_TERMINAL_ACCESS</span>
      <span class="text-slate-500 text-xs">Press 'Ctrl + /' to close</span>
    </div>
    <div id="terminal-output" class="flex-1 overflow-y-auto space-y-1 pb-4">
      <div>> System initialized.</div>
      <div>> Type 'gravity' to start physics engine.</div>
    </div>
    <div class="flex items-center gap-2 text-white">
      <span class="text-indigo-400">visitor@portfolio:~$</span>
      <input type="text" id="terminal-input" class="bg-transparent border-none outline-none flex-1 font-mono text-white placeholder-slate-600" placeholder="Type command..." autocomplete="off">
    </div>
  </div>

  <!-- 卡片展開層 (App Store 風格) -->
  <div id="card-overlay" class="card-overlay">
    <div class="card-expanded" id="expanded-content">
      <!-- JS 動態填入 -->
    </div>
  </div>

  <!-- 聊天視窗 -->
  <div class="chat-window" id="chat-window" style="width: 320px; height: 450px;">
    <div id="chat-resize-handle" class="resize-handle" title="Drag to resize"></div>
    <div class="chat-header">
      <div class="flex items-center gap-2 ml-4">
        <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
        <span class="font-bold text-emerald-400 text-sm">Live Chat</span>
      </div>
      <button onclick="toggleChat()" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
    </div>
    <div id="chat-notice-area"></div> <!-- Cookie Notice -->
    <div class="chat-messages" id="chat-messages">
      <div class="text-center text-xs text-slate-500 my-4">Start a conversation</div>
    </div>
    <div class="chat-input-area">
      <input type="text" id="chat-input" placeholder="Type a message..." class="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white outline-none focus:border-emerald-500" onkeydown="if(event.key==='Enter') sendMessage()">
      <button onclick="sendMessage()" class="w-10 h-10 bg-emerald-600 rounded-lg text-white hover:bg-emerald-500 transition"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <!-- 懸浮工具列 (Dock) - 右側垂直 / 底部水平 -->
  <div class="floating-dock">
    <div class="dock-item" data-tooltip="HOME" onclick="window.scrollTo({top:0, behavior:'smooth'})">
      <i class="fas fa-home"></i>
    </div>
    <div class="dock-item" data-tooltip="WORK" onclick="document.getElementById('links-container').scrollIntoView({behavior:'smooth'})">
      <i class="fas fa-layer-group"></i>
    </div>
    <div class="dock-item" data-tooltip="SKILLS" onclick="document.querySelector('.marquee-container').scrollIntoView({behavior:'smooth'})">
      <i class="fas fa-code"></i>
    </div>
    <!-- 分隔線 -->
    <div class="w-px h-6 md:w-6 md:h-px bg-white/10 self-center mx-1 md:my-1 md:mx-0"></div>

    <div class="dock-item" data-tooltip="TERMINAL" onclick="toggleTerminal()">
      <i class="fas fa-terminal"></i>
    </div>
    <div class="dock-item" data-tooltip="CHAT" onclick="toggleChat()">
      <i class="fas fa-comment-dots"></i>
      <span id="dock-chat-badge" class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full hidden animate-ping"></span>
    </div>
    <div class="dock-item" data-tooltip="SOUND" id="dock-sound-btn">
      <i class="fas fa-volume-mute"></i>
    </div>
  </div>

  <!-- 自定義右鍵選單 -->
  <div id="context-menu">
    <div class="ctx-item cursor-hover" onclick="location.reload()">
      <i class="fas fa-sync-alt w-4"></i> Reload System
      <span class="ctx-shortcut">F5</span>
    </div>
    <div class="ctx-item cursor-hover" onclick="toggleTerminal()">
      <i class="fas fa-terminal w-4"></i> Open Terminal
      <span class="ctx-shortcut">^/</span>
    </div>
    <div class="ctx-divider"></div>
    <div class="ctx-item cursor-hover" onclick="initGravity()">
      <i class="fas fa-apple-alt w-4"></i> Gravity Mode
    </div>
    <div class="ctx-item cursor-hover" onclick="toggleSound()">
      <i class="fas fa-music w-4"></i> Toggle Sound
    </div>
    <div class="ctx-divider"></div>
    <div class="text-[10px] text-slate-500 px-3 py-1 text-center opacity-60 select-none">
      Hold <span class="text-slate-300 font-bold">Shift</span> + Right Click for Default
    </div>
  </div>

  <main id="main-content" class="relative z-10 max-w-6xl mx-auto px-6 py-24 pb-32">
    <!-- Header -->
    <div class="flex flex-col-reverse lg:flex-row items-center justify-between mb-32 gap-16 opacity-0 animate-fade-up" style="animation-delay: 0.2s;">
      <div class="text-center lg:text-left flex-1 space-y-8 physics-body">
        <div class="inline-flex items-center gap-2 px-4 py-1.5 text-xs font-semibold tracking-wider text-indigo-300 bg-indigo-500/10 rounded-full border border-indigo-500/20 cursor-hover transition hover:bg-indigo-500/20">
          <span class="relative flex h-2 w-2">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-indigo-500"></span>
          </span>
          AVAILABLE FOR HIRE
        </div>
        <div class="space-y-4">
          <h1 class="text-4xl md:text-7xl lg:text-8xl font-extrabold tracking-tight text-white leading-tight">
            Hello, I'm <br/>
            <span id="site-title" class="hack-text text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-purple-400 to-emerald-400 cursor-hover">Loading...</span>
          </h1>
          <div class="text-lg md:text-2xl text-slate-400 font-light h-8 font-mono">
            > I am a <span id="typewriter" class="gradient-text-anim font-bold typing-cursor"></span>
          </div>
        </div>
        <!-- 換行支援 -->
        <p id="bio-text" class="text-base md:text-lg text-slate-400 max-w-lg mx-auto lg:mx-0 leading-relaxed whitespace-pre-line">Fetching profile data...</p>
        <div id="social-links" class="flex gap-6 justify-center lg:justify-start pt-4 physics-body flex-wrap"></div>
      </div>

      <div class="relative group physics-body">
         <div class="absolute inset-0 bg-gradient-to-tr from-indigo-500 to-emerald-500 rounded-[2rem] blur-2xl opacity-40 group-hover:opacity-60 transition duration-700"></div>
         <div class="relative w-64 h-64 md:w-72 md:h-72 lg:w-96 lg:h-96 glass-card rounded-[2rem] p-3 overflow-hidden cursor-hover rotate-3 group-hover:rotate-0 transition duration-500">
            <img id="avatar-img" src="https://placehold.co/400x400/1e293b/FFF?text=..." class="w-full h-full rounded-[1.5rem] object-cover pointer-events-none">
         </div>
      </div>
    </div>

    <!-- 卡片連結區 (單欄緊湊) -->
    <div class="mb-32 opacity-0 animate-fade-up" style="animation-delay: 0.4s;">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl md:text-3xl font-bold text-white tracking-tight">Selected Work</h2>
        <div class="h-px bg-slate-800 flex-1 ml-8 opacity-50"></div>
      </div>
      <div id="links-container" class="grid grid-cols-1 gap-6">
        <div class="col-span-full text-center py-20">
          <div class="animate-spin w-10 h-10 border-4 border-indigo-500 border-t-transparent rounded-full inline-block"></div>
        </div>
      </div>
    </div>

    <!-- 技能牆 -->
    <div class="mb-20 py-12 opacity-0 animate-fade-up" style="animation-delay: 0.6s;">
      <p class="text-center text-slate-500 text-sm tracking-widest uppercase mb-8">Technologies</p>
      <div class="marquee-container overflow-hidden relative w-full">
        <div class="marquee-content flex gap-16 w-max items-center">
          <div class="flex gap-16 items-center text-4xl md:text-5xl text-slate-600">
            <i class="fab fa-html5 hover:text-orange-500 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-css3-alt hover:text-blue-500 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-js hover:text-yellow-400 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-react hover:text-cyan-400 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-vuejs hover:text-green-500 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-node hover:text-green-600 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-python hover:text-yellow-300 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-git-alt hover:text-orange-600 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
          </div>
          <div class="flex gap-16 items-center text-4xl md:text-5xl text-slate-600">
            <i class="fab fa-html5 hover:text-orange-500 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-css3-alt hover:text-blue-500 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-js hover:text-yellow-400 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-react hover:text-cyan-400 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-vuejs hover:text-green-500 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-node hover:text-green-600 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-python hover:text-yellow-300 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
            <i class="fab fa-git-alt hover:text-orange-600 transition duration-300 hover:-translate-y-2 cursor-hover"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer 連結 -->
    <footer class="text-center text-slate-500 text-sm pb-10 border-t border-slate-800/30 pt-8 opacity-0 animate-fade-up" style="animation-delay: 0.8s;">
      <p class="mb-4">&copy; <span id="year"></span> <span id="footer-name" class="text-slate-300">Me</span>. <span class="text-xs text-indigo-400/50 hidden md:inline">Ctrl+/ for terminal</span></p>
      
      <div class="flex justify-center gap-6 text-xs">
        <a href="privacy.html" class="hover:text-emerald-400 transition-colors duration-200 relative group">Privacy Policy<span class="absolute -bottom-1 left-0 w-0 h-px bg-emerald-400 transition-all group-hover:w-full"></span></a>
        <a href="terms.html" class="hover:text-emerald-400 transition-colors duration-200 relative group">Terms of Service<span class="absolute -bottom-1 left-0 w-0 h-px bg-emerald-400 transition-all group-hover:w-full"></span></a>
        <a href="disclaimer.html" class="hover:text-emerald-400 transition-colors duration-200 relative group">Disclaimer<span class="absolute -bottom-1 left-0 w-0 h-px bg-emerald-400 transition-all group-hover:w-full"></span></a>
      </div>
    </footer>
  </main>

  <!-- === JS LOGIC === -->
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
    let typingWords = ["Creative Developer", "Designer"]; 
    let isMuted = true;
    let audioCtx;
    let isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    function updateLoader(percent) {
      document.getElementById('loader-progress').style.width = percent + '%';
    }

    window.onload = function() {
      updateLoader(50); 
      if (!isMobile) initFluidCursor();
      initScrollProgress();
      initDock();       
      initContextMenu(); // Check shift key internally
      initTerminal();
      if (!isMobile) initMagneticButtons(); 
      if (!isMobile) initSpotlightCards();  
      initClickRipple();
      
      // Chat Session & Resize
      initResizableChat();
      initChatCookieNotice();
      let sessionId = localStorage.getItem('chat_session_id');
      if (!sessionId) {
        sessionId = 'sess_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('chat_session_id', sessionId);
      }
      window.sessionId = sessionId;
      fetchChatHistory();
      setInterval(fetchChatHistory, 10000);

      fetchData().then(() => {
        updateLoader(100);
        setTimeout(() => {
          const preloader = document.getElementById('preloader');
          preloader.style.opacity = '0';
          preloader.style.visibility = 'hidden';
        }, 800); 
      });
    };

    // Chat Resize
    function initResizableChat() {
      const chatWindow = document.getElementById('chat-window');
      const handle = document.getElementById('chat-resize-handle');
      let isResizing = false, startX, startY, startWidth, startHeight;
      handle.addEventListener('mousedown', (e) => {
        isResizing = true; startX = e.clientX; startY = e.clientY;
        startWidth = parseInt(getComputedStyle(chatWindow).width, 10);
        startHeight = parseInt(getComputedStyle(chatWindow).height, 10);
        document.body.style.cursor = 'nwse-resize'; e.preventDefault();
      });
      document.addEventListener('mousemove', (e) => {
        if (!isResizing) return;
        const width = startWidth + (startX - e.clientX);
        const height = startHeight + (startY - e.clientY);
        if (width > 300 && width < 600) chatWindow.style.width = `${width}px`;
        if (height > 400 && height < 800) chatWindow.style.height = `${height}px`;
      });
      document.addEventListener('mouseup', () => { isResizing = false; document.body.style.cursor = ''; });
    }

    function initChatCookieNotice() {
      if (localStorage.getItem('chat_cookie_accepted') === 'true') return;
      const noticeArea = document.getElementById('chat-notice-area');
      const alert = document.createElement('div');
      alert.className = 'cookie-alert';
      alert.innerHTML = `<i class="fas fa-info-circle"></i><div class="flex-1">為保存對話紀錄，本站使用 Cookies。<br><span class="text-[9px] opacity-70">清理快取將遺失對話。</span></div><button onclick="acceptChatCookie(this)" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>`;
      noticeArea.appendChild(alert);
    }
    function acceptChatCookie(btn) { localStorage.setItem('chat_cookie_accepted', 'true'); btn.parentElement.remove(); }

    async function fetchData() {
      try {
        const response = await fetch(`${API_URL}?type=api`);
        const result = await response.json();
        if (result.status === 'success') {
          renderSettings(result.settings);
          renderLinks(result.data);
        } else {
          document.getElementById('site-title').textContent = "Error";
        }
      } catch (error) {
        document.getElementById('site-title').textContent = "Offline";
      }
    }

    function renderSettings(s) {
      if(!s) return;
      document.title = s.site_title || 'Portfolio';
      const titleEl = document.getElementById('site-title');
      titleEl.textContent = s.site_title || 'User';
      document.getElementById('footer-name').textContent = s.site_title || 'Me';
      document.getElementById('bio-text').textContent = s.bio_text || '';
      if(s.avatar_url) document.getElementById('avatar-img').src = s.avatar_url;
      if (s.site_subtitle) typingWords = s.site_subtitle.split(',').map(w => w.trim());
      startTypewriter();
      
      const social = document.getElementById('social-links');
      let html = '';
      const btnClass = "magnetic-btn w-12 h-12 rounded-full glass-card flex items-center justify-center text-slate-400 hover:text-white hover:bg-white/10 transition-colors cursor-hover text-xl";
      
      const links = [
        {k:'github_username', u:`https://github.com/${s.github_username}`, i:'fab fa-github', t:'GitHub'},
        {k:'instagram_url', u:s.instagram_url, i:'fab fa-instagram', t:'Instagram'},
        {k:'twitter_url', u:s.twitter_url, i:'fab fa-twitter', t:'Twitter'},
        {k:'linkedin_url', u:s.linkedin_url, i:'fab fa-linkedin', t:'LinkedIn'},
        {k:'facebook_url', u:s.facebook_url, i:'fab fa-facebook', t:'Facebook'},
        {k:'youtube_url', u:s.youtube_url, i:'fab fa-youtube', t:'YouTube'},
        {k:'email_address', u:`mailto:${s.email_address}`, i:'fas fa-envelope', t:'Email'},
        {k:'website_url', u:s.website_url, i:'fas fa-globe', t:'Website'}
      ];
      
      links.forEach(link => {
         if(s[link.k]) html += `<a href="${link.u}" target="_blank" class="${btnClass}" title="${link.t}"><i class="${link.i}"></i></a>`;
      });
      social.innerHTML = html;
      if(!isMobile) initMagneticButtons(); 
    }

    function renderLinks(data) {
      const container = document.getElementById('links-container');
      container.innerHTML = '';
      if (!data || data.length === 0) { container.innerHTML = '<div class="col-span-full text-center text-slate-500">No content available</div>'; return; }
      data.forEach((item, idx) => {
        const html = `
          <div onclick='openCard(${JSON.stringify(item)})' 
             class="glass-card spotlight-card group relative flex flex-col md:flex-row rounded-xl overflow-hidden cursor-pointer physics-body hover:scale-[1.01] transition-transform duration-300">
            <div class="h-48 md:h-auto md:w-1/4 relative overflow-hidden shrink-0 border-b md:border-b-0 md:border-r border-slate-700/50">
               <img src="${item.imageUrl || 'https://placehold.co/600x400/1e293b/FFF?text=Image'}" 
                    class="w-full h-full object-cover transition duration-700 group-hover:scale-105 pointer-events-none">
               <div class="absolute inset-0 bg-gradient-to-t from-[#0a0a0a] to-transparent opacity-60 pointer-events-none"></div>
            </div>
            <div class="flex-1 p-6 flex flex-col justify-center relative z-10">
              <div class="flex justify-between items-start mb-2">
                <h3 class="text-xl font-bold text-white group-hover:text-indigo-300 transition">${item.title}</h3>
                <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center group-hover:bg-indigo-500 group-hover:text-white transition duration-300 shrink-0 ml-4">
                  <i class="fas fa-arrow-up-right text-xs transform group-hover:rotate-45 transition"></i>
                </div>
              </div>
              <p class="text-slate-400 text-sm leading-relaxed whitespace-pre-line line-clamp-2 md:line-clamp-3">${item.description || ''}</p>
            </div>
          </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
      });
      if(!isMobile) initSpotlightCards();
    }

    function openCard(item) {
      const overlay = document.getElementById('card-overlay');
      const content = document.getElementById('expanded-content');
      content.innerHTML = `
        <div class="close-btn" onclick="closeCard()"><i class="fas fa-times"></i></div>
        <div class="h-64 md:h-96 relative">
           <img src="${item.imageUrl || 'https://placehold.co/800'}" class="w-full h-full object-cover">
           <div class="absolute inset-0 bg-gradient-to-t from-[#0a0a0a] to-transparent"></div>
           <div class="absolute bottom-0 left-0 p-8">
              <h2 class="text-3xl md:text-4xl font-bold text-white mb-2">${item.title}</h2>
              <a href="${item.url}" target="_blank" class="inline-flex items-center gap-2 px-6 py-2 bg-emerald-500 text-white rounded-full font-bold hover:bg-emerald-400 transition shadow-lg shadow-emerald-500/30">
                Visit Project <i class="fas fa-external-link-alt"></i>
              </a>
           </div>
        </div>
        <div class="p-8 md:p-12 prose prose-invert max-w-none">
           <p class="text-slate-300 text-lg leading-relaxed whitespace-pre-line">${item.description || 'No description.'}</p>
        </div>
      `;
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function closeCard() { document.getElementById('card-overlay').classList.remove('active'); document.body.style.overflow = ''; }

    function toggleChat() {
      const win = document.getElementById('chat-window');
      win.classList.toggle('open');
      if(win.classList.contains('open')) { document.getElementById('dock-chat-badge').classList.add('hidden'); scrollToBottom(); fetchChatHistory(); }
    }
    async function sendMessage() {
      const input = document.getElementById('chat-input'); const msg = input.value.trim();
      if (!msg) return; appendMessage('User', msg); input.value = ''; scrollToBottom();
      try { await fetch(API_URL, { method: 'POST', body: JSON.stringify({ action: 'sendMessage', payload: { sessionId: window.sessionId, message: msg } }) }); } catch (e) {}
    }
    async function fetchChatHistory() {
      try {
        const res = await fetch(`${API_URL}?type=api`, { method: 'POST', body: JSON.stringify({ action: 'getChatHistory', payload: { sessionId: window.sessionId } }) });
        const result = await res.json();
        if (result.status === 'success') {
          const container = document.getElementById('chat-messages');
          let html = '<div class="text-center text-xs text-slate-500 my-4">Start a conversation</div>';
          result.data.forEach(m => { const cls = m.sender === 'User' ? 'msg-user' : 'msg-admin'; html += `<div class="msg-bubble ${cls}">${m.message}</div>`; });
          container.innerHTML = html; scrollToBottom();
        }
      } catch(e) {}
    }
    function appendMessage(sender, text) {
      const container = document.getElementById('chat-messages'); const div = document.createElement('div');
      div.className = `msg-bubble ${sender === 'User' ? 'msg-user' : 'msg-admin'}`; div.textContent = text; container.appendChild(div);
    }
    function scrollToBottom() { const div = document.getElementById('chat-messages'); div.scrollTop = div.scrollHeight; }

    let engine, runner, gravityTimeout, isGravityActive = false;
    function initGravity() {
      if (isGravityActive) return; isGravityActive = true;
      const btn = document.createElement('button'); btn.id = 'exit-gravity-btn'; btn.className = 'fixed top-6 right-6 z-[10002] bg-red-600/90 hover:bg-red-500 text-white px-6 py-2 rounded-full font-mono font-bold shadow-[0_0_20px_rgba(220,38,38,0.5)] transition-all transform hover:scale-105 flex items-center gap-2 backdrop-blur-md';
      btn.innerHTML = '<i class="fas fa-power-off"></i> ABORT PHYSICS'; btn.onclick = stopGravity; document.body.appendChild(btn);
      gravityTimeout = setTimeout(stopGravity, 30000);
      const Engine = Matter.Engine, World = Matter.World, Bodies = Matter.Bodies, Mouse = Matter.Mouse, MouseConstraint = Matter.MouseConstraint;
      engine = Engine.create();
      const elements = document.querySelectorAll('.physics-body'); const bodies = [];
      elements.forEach(el => {
        const rect = el.getBoundingClientRect(); el.dataset.origStyle = el.getAttribute('style') || ''; 
        const body = Bodies.rectangle(rect.left + rect.width / 2, rect.top + rect.height / 2, rect.width, rect.height, { restitution: 0.8, friction: 0.5 });
        body.domElement = el; bodies.push(body);
        el.style.position = 'fixed'; el.style.width = rect.width + 'px'; el.style.height = rect.height + 'px'; el.style.zIndex = '9999'; el.style.left = '0'; el.style.top = '0'; el.style.transform = `translate(${rect.left}px, ${rect.top}px)`;
      });
      const wallOptions = { isStatic: true, render: { visible: false } };
      let ground = Bodies.rectangle(window.innerWidth / 2, window.innerHeight + 50, window.innerWidth, 100, wallOptions);
      let wallL = Bodies.rectangle(-50, window.innerHeight / 2, 100, window.innerHeight, wallOptions);
      let wallR = Bodies.rectangle(window.innerWidth + 50, window.innerHeight / 2, 100, window.innerHeight, wallOptions);
      let ceiling = Bodies.rectangle(window.innerWidth / 2, -500, window.innerWidth, 100, wallOptions);
      World.add(engine.world, [ground, wallL, wallR, ceiling, ...bodies]);
      runner = Matter.Runner.create(); Matter.Runner.run(runner, engine);
      function update() {
        if (!isGravityActive) return;
        bodies.forEach(b => { const el = b.domElement; if(el) { const x = b.position.x - el.offsetWidth / 2; const y = b.position.y - el.offsetHeight / 2; el.style.transform = `translate(${x}px, ${y}px) rotate(${b.angle}rad)`; } });
        requestAnimationFrame(update);
      }
      requestAnimationFrame(update);
      const mouseConstraint = MouseConstraint.create(engine, { element: document.body, mouse: Mouse.create(document.body) });
      World.add(engine.world, mouseConstraint);
    }
    function stopGravity() {
        if (!isGravityActive) return; isGravityActive = false; clearTimeout(gravityTimeout);
        const btn = document.getElementById('exit-gravity-btn'); if (btn) btn.remove();
        if (runner) Matter.Runner.stop(runner); if (engine) Matter.Engine.clear(engine);
        document.querySelectorAll('.physics-body').forEach(el => { el.style = el.dataset.origStyle || ''; el.style.transform = ''; });
    }

    function initClickRipple() {
      window.addEventListener('click', (e) => { const r = document.createElement('div'); r.className = 'ripple'; r.style.left=`${e.clientX}px`; r.style.top=`${e.clientY}px`; document.body.appendChild(r); for(let i=0; i<6; i++) createParticle(e.clientX, e.clientY); setTimeout(() => r.remove(), 600); });
    }
    function createParticle(x, y) {
      const p = document.createElement('div'); p.style.cssText = `position:absolute; width:4px; height:4px; background:#10b981; border-radius:50%; pointer-events:none; z-index:9998; left:${x}px; top:${y}px;`; document.body.appendChild(p);
      const dx = (Math.random() - 0.5) * 100; const dy = (Math.random() - 0.5) * 100;
      p.animate([{ transform: 'translate(0,0)', opacity: 1 }, { transform: `translate(${dx}px, ${dy}px)`, opacity: 0 }], { duration: 600 }).onfinish = () => p.remove();
    }
    function initMagneticButtons() {
      document.querySelectorAll('.magnetic-btn').forEach(btn => { btn.addEventListener('mousemove', (e) => { const r = btn.getBoundingClientRect(); const x = e.clientX - r.left - r.width/2; const y = e.clientY - r.top - r.height/2; btn.style.transform = `translate(${x*0.3}px, ${y*0.3}px)`; }); btn.addEventListener('mouseleave', () => btn.style.transform = 'translate(0,0)'); });
    }
    function initSpotlightCards() {
      const cards = document.getElementsByClassName('spotlight-card'); document.getElementById('links-container').onmousemove = e => { for (const c of cards) { const r = c.getBoundingClientRect(); c.style.setProperty('--mouse-x', `${e.clientX - r.left}px`); c.style.setProperty('--mouse-y', `${e.clientY - r.top}px`); } };
    }
    function initFluidCursor() {
      const dot = document.querySelector('.cursor-dot'), outline = document.querySelector('.cursor-outline'); let m = {x:0, y:0}, o = {x:0, y:0};
      window.addEventListener('mousemove', e => { m.x=e.clientX; m.y=e.clientY; dot.style.left=`${m.x}px`; dot.style.top=`${m.y}px`; });
      window.addEventListener('mousedown', () => document.body.classList.add('clicking')); window.addEventListener('mouseup', () => document.body.classList.remove('clicking'));
      const anim = () => { o.x += (m.x - o.x)*0.15; o.y += (m.y - o.y)*0.15; outline.style.left=`${o.x}px`; outline.style.top=`${o.y}px`; requestAnimationFrame(anim); }; anim();
      new MutationObserver(ms => ms.forEach(m => { if(m.addedNodes.length) attachHover(); })).observe(document.body, {childList:true, subtree:true});
      function attachHover() { document.querySelectorAll('a, button, .cursor-hover, .dock-item, .ctx-item').forEach(el => { el.addEventListener('mouseenter', () => document.body.classList.add('hovering')); el.addEventListener('mouseleave', () => document.body.classList.remove('hovering')); }); } attachHover();
    }
    function initDock() { const b = document.getElementById('dock-sound-btn'); b.addEventListener('click', toggleSound); }
    function initContextMenu() { const m = document.getElementById('context-menu'); document.addEventListener('contextmenu', (e) => { if (e.shiftKey) { m.style.display = 'none'; return; } e.preventDefault(); const x = e.clientX, y = e.clientY, mW = 200, mH = 200, fX = x + mW > window.innerWidth ? x - mW : x, fY = y + mH > window.innerHeight ? y - mH : y; m.style.left = `${fX}px`; m.style.top = `${fY}px`; m.style.display = 'block'; }); document.addEventListener('click', () => m.style.display = 'none'); }
    function toggleSound() { if (!audioCtx) audioCtx = new AudioContext(); if (audioCtx.state === 'suspended') audioCtx.resume(); isMuted = !isMuted; const icons = document.querySelectorAll('.fa-volume-mute, .fa-volume-up'); icons.forEach(icon => { icon.className = isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up text-emerald-400'; }); if(!isMuted) playTone(600, 'sine', 0.1); }
    function toggleTerminal() { const o = document.getElementById('terminal-overlay'), i = document.getElementById('terminal-input'); if(o.classList.contains('-translate-y-full')) { o.classList.remove('-translate-y-full'); i.focus(); if(!isMuted && audioCtx) playTone(200, 'square', 0.2); } else { o.classList.add('-translate-y-full'); } }
    function playTone(f,t,d) { if(!audioCtx) return; const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type=t; o.frequency.setValueAtTime(f, audioCtx.currentTime); g.gain.setValueAtTime(0.05, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+d); o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+d); }
    function initTerminal() { const o=document.getElementById('terminal-overlay'), i=document.getElementById('terminal-input'), out=document.getElementById('terminal-output'); document.addEventListener('keydown', e => { if(e.key === '/' && (e.ctrlKey || e.metaKey)) { e.preventDefault(); toggleTerminal(); } }); i.addEventListener('keydown', e => { if(e.key==='Enter') { const c=i.value; i.value=''; printLog(`user@port:~$ ${c}`); process(c.trim().toLowerCase()); } }); function printLog(h) { const d=document.createElement('div'); d.innerHTML=h; out.appendChild(d); out.scrollTop=out.scrollHeight; } function process(c) { let r=''; switch(c) { case 'help': r='Commands: ls, cat, gravity, matrix, exit'; break; case 'ls': r='gravity_module.exe  secrets.txt'; break; case 'gravity': r='Activating Zero-G Physics Engine...'; setTimeout(initGravity, 1000); break; case 'matrix': r='Wake up, Neo...'; break; case 'exit': toggleTerminal(); break; default: r=`Unknown: ${c}`; } printLog(r); } }
    function startTypewriter() { const el=document.getElementById('typewriter'); let w=0, c=0, d=false; function type() { if(!typingWords.length) return; const txt = typingWords[w]; el.textContent = txt.substring(0, d?c-1:c+1); d?c--:c++; let s = d?30:80; if(!d && c===txt.length) { d=true; s=2500; } else if(d && c===0) { d=false; w=(w+1)%typingWords.length; s=500; } setTimeout(type, s); } type(); }
    function initScrollProgress() { const bar=document.getElementById('scroll-progress'); window.addEventListener('scroll', () => { const s = document.documentElement.scrollTop || document.body.scrollTop; const h = document.documentElement.scrollHeight - document.documentElement.clientHeight; bar.style.width = `${(s/h)*100}%`; }); }
  </script>
</body>

</html>
